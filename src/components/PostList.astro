---
import PostPreview from './PostPreview.astro'
import { getCollection } from 'astro:content';

const posts = await getCollection("posts");
const sortedPosts = posts
    .map(post => {
        return {...post.data, slug: post.slug};
    })    
    .sort((a: any, b: any) => {
        return new Date(b.publishDate).valueOf() - new Date(a.publishDate).valueOf();
    })
    .filter((post: any) => {
        return post.title !== "About Me" && !post.draft;
    });
---
<style>
  /* Switched to a semantic <main> tag */
  main {
    width: 60vw;
    margin: 0 auto; 
    margin-top: 2rem;
  }

  ul {
    list-style: none;
    display: flex;
    flex-direction: column;
    padding: 0;
    
    /* MODIFICATION: Let the list fill the main container */
    width: 100%; 
    gap: 0;
  }
 
  ul > :global(li) {
    /* MODIFICATION: Ensure list items take up the full width */
    width: 100%; 
    padding-bottom: 2.5rem; 
    margin-bottom: 2.5rem; 
    border-bottom: 1px solid var(--border-subtle, #475569);
  }

  ul > :global(li:last-child) {
    border-bottom: none;
    margin-bottom: 0;
  }
</style>

<main>
    {sortedPosts.length === 0 ? <p>No posts yet!</p> : 
        <ul>
            {sortedPosts.map((post: any) => 
                <PostPreview 
                    title={post.title} 
                    publishDate={new Date(post.publishDate).toLocaleDateString("en-US", {
                        year: "numeric",
                        month: "long",
                        day: "numeric"
                    })}
                    author={post.author}
                    description={post.description}
                    slug={post.slug}
                />)}
        </ul>
    }
</main>